<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle</title>
    <!-- Style Sheet-->
    <link rel="icon" href="/img/homepage/logoweb.ico" type="images/x-ico" />
    <link rel="stylesheet" id="bootstrap-css-css" href="/css/back/bootstrap5152.css" type="text/css" media="all">
    <link rel="stylesheet" id="responsive-css-css" href="/css/back/responsive5152.css" type="text/css" media="all">
    <link rel="stylesheet" id="pretty-photo-css-css" href="/css/back/prettyPhotoaeb9.css" type="text/css" media="all">
    <link rel="stylesheet" id="main-css-css" href="/css/back/main5152.css" type="text/css" media="all">
    <script src="https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
    <style>
        body{
            background: white !important;
        }
    </style>
</head>

<body>
<div class="header-wrapper">
    <header>
        <div class="container">
            <div class="logo-container">
                <a href="/"><span class="tag-line">知识图谱-Puzzle</span> </a>
            </div>
            <!-- Start of Main Navigation -->
            <nav class="main-nav">
                <div class="menu-top-menu-container">
                    <ul id="menu-top-menu" class="clearfix">
                        <li><a href="/display">可视化</a></li>
                        <li><a href="/3dnodes">3D视图</a></li>
                        <li><a href="/robot">智能问答</a></li>
                        <li><a href="#about">论文</a></li>
                        <li><a href="#contact">联系</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>
</div>
<!-- End of Header -->


<main role="main" style="text-align: center">

    <h2>分布式系统情况监控</h2>
    <div class="table-responsive" style="width: 70%; margin:0 auto">
        <table class="table table-striped table-sm">
            <thead>
            <tr>
                <th>编号</th>
                <th>机器代号</th>
                <th>CPU占有率</th>
                <th>内存占有率</th>
                <th>状态</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td>M0-深圳</td>
                <td id="cpu_0"></td>
                <td>dolor</td>
                <td>sit</td>
            </tr>
            <tr>
                <td>2</td>
                <td>M1-洛杉矶</td>
                <td id="cpu_1"></td>
                <td>dolor</td>
                <td>sit</td>
            </tr>
            <tr>
                <td>3</td>
                <td>M2-香港</td>
                <td id="cpu_2"></td>
                <td>dolor</td>
                <td>sit</td>
            </tr>

            </tbody>
        </table>
    </div>

    <div style="display:flex; margin-left: 5%">
        <div id="container_0" style="height: 300px; width: 30%;float:left;background-color: lightblue"></div>
        <div id="container_1" style="height: 300px; width: 30%;float:left;background-color: lightgoldenrodyellow"></div>
        <div id="container_2" style="height: 300px; width: 30%;float:left;background-color: #ffe3db"></div>
    </div>

    <button onclick="cpu_update()">add</button>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
    <script type="text/javascript">
        var max_size = 200;
        var server_size = 3;
        var servername = ["M0-深圳 CPU占有率", "M1-洛杉矶 CPU占有率", "M2-香港 CPU占有率"];
        var date = []; // 二维数组，存储cpu 时间与cpu load关系
        var data = [];

        var cpuChart = [];
        for(var i=0;i<server_size;i++){
            cpuChart.push(echarts.init(document.getElementById("container_"+i)));
            data[i] = []; // 二维数组初始化
            date[i] = [];
            for(var j=0;j<max_size;j++){
                data[i].push(0);
                date[i].push("");
            }
            init(cpuChart[i],data[i], date[i]);
        }

        function cpu_update(){
            $.ajax({
                url: "/cpu",
                async: false,
                success: function(response) {
                    date[0].push('');
                    data[0].push(response[0]["cpu"]);
                    $("#cpu_0").text(response[0]["cpu"]+"%");
                    if (date[0].length > max_size) {
                        data[0] = data[0].slice(-max_size);
                        date[0] = date[0].slice(-max_size);
                    }
                    cpuChart[0].setOption({
                        xAxis: {
                            data: date[0]
                        },
                        series: [{
                            data: data[0]
                        }]
                    });
                },
                error: function(response) {
                    date[0].push('');
                    data[0].push(-5);
                    $("#cpu_0").text(response[0]["cpu"]+"%");
                    if (date.length > max_size) {
                        data[0] = data[0].slice(-max_size);
                        date[0] = date[0].slice(-max_size);
                    }
                    cpuChart[0].setOption({
                        xAxis: {
                            data: date[0]
                        },
                        series: [{
                            data: data[0]
                        }]
                    });
                }
            });
        }


        function init(chart, data, date) {
            chart.setOption({
                tooltip: {
                    trigger: 'axis',
                    position: function(pt) {
                        return [pt[0], '10%'];
                    }
                },
                title: {
                    left: 'center',
                    text: servername[0]
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: date
                },
                yAxis: {
                    type: 'value',
                    boundaryGap: [0, '50%']
                },
                series: [{
                    name: 'CPU占有率',
                    type: 'line',
                    smooth: false,
                    symbol: 'none',
                    sampling: 'average',
                    itemStyle: {
                        color: 'rgb(255, 70, 131)'
                    },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: 'rgb(255, 158, 68)'
                        }, {
                            offset: 1,
                            color: 'rgb(255, 70, 131)'
                        }])
                    },
                    data: data
                }]
            });

            window.setInterval(cpu_update, 1000);
        }
    </script>


</main>

</body>
